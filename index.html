<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Cricket AR - Virtual Batting</title>
    <meta name="description" content="Browser-based AR cricket game using hand gestures to bat">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">

    <link rel="stylesheet" href="css/styles.css">

    <!-- Import Map for ES Modules -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "cannon-es": "https://cdn.jsdelivr.net/npm/cannon-es@0.20.0/dist/cannon-es.js"
        }
    }
    </script>

    <!-- MediaPipe for hand tracking (these are not ES modules) -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1675469240/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3.1675466862/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.3.1675466124/drawing_utils.js"></script>
</head>

<body>
    <div id="app">
        <!-- Loading Screen -->
        <div id="loading-screen">
            <div class="loader">
                <div class="cricket-ball"></div>
                <p>Loading Cricket AR...</p>
                <p class="loading-status">Initializing camera...</p>
            </div>
        </div>

        <!-- Main Game Container -->
        <div id="game-container">
            <!-- Camera View (Left Panel) -->
            <div id="camera-panel">
                <video id="camera-feed" autoplay playsinline></video>
                <canvas id="camera-overlay"></canvas>
                <div id="ball-trajectory-overlay"></div>
                <div id="hand-status">
                    <span class="status-dot"></span>
                    <span class="status-text">Detecting hands...</span>
                </div>
            </div>

            <!-- 3D Field View (Right Panel) -->
            <div id="field-panel">
                <canvas id="field-canvas"></canvas>
                <div id="shot-result"></div>
                <div id="next-ball-warning"></div>

                <!-- Game Over Screen -->
                <div id="game-over-screen">
                    <div class="game-over-content">
                        <h2>INNINGS COMPLETE</h2>
                        <div class="final-score">
                            <span id="final-runs">0</span>/<span id="final-wickets">0</span>
                        </div>
                        <div class="match-stats">
                            <p>Overs: <span id="final-overs">0.0</span></p>
                        </div>
                        <button id="play-again-btn">
                            PLAY AGAIN ‚Üª
                        </button>
                    </div>
                </div>
            </div>

            <style>
                #next-ball-warning {
                    position: absolute;
                    bottom: 15%;
                    /* Lower position like TV ticker */
                    left: 0;
                    right: 0;
                    width: 100%;
                    height: 60px;
                    background: linear-gradient(90deg, rgba(0, 30, 60, 0) 0%, rgba(0, 30, 60, 0.9) 20%, rgba(0, 30, 60, 0.9) 80%, rgba(0, 30, 60, 0) 100%);
                    display: flex;
                    align-items: center;
                    justify-content: center;

                    font-family: 'Segoe UI', Arial, sans-serif;
                    font-size: 24px;
                    font-weight: 700;
                    font-style: italic;
                    color: #fff;
                    letter-spacing: 2px;
                    text-transform: uppercase;

                    opacity: 0;
                    transform: translateY(20px);
                    transition: all 0.5s cubic-bezier(0.2, 1, 0.3, 1);
                    z-index: 100;
                    pointer-events: none;
                }

                #next-ball-warning.visible {
                    opacity: 1;
                    transform: translateY(0);
                }

                /* Icon/Text container inside */
                #next-ball-warning::before {
                    content: 'üèè';
                    margin-right: 15px;
                    font-style: normal;
                    animation: spin 2s infinite linear;
                }

                @keyframes spin {
                    0% {
                        transform: rotate(0deg);
                    }

                    100% {
                        transform: rotate(360deg);
                    }
                }

                /* Game Over Screen */
                #game-over-screen {
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 20, 40, 0.85);
                    backdrop-filter: blur(8px);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    opacity: 0;
                    pointer-events: none;
                    transition: opacity 0.5s ease;
                    z-index: 200;
                }

                #game-over-screen.visible {
                    opacity: 1;
                    pointer-events: auto;
                }

                .game-over-content {
                    text-align: center;
                    color: white;
                    background: linear-gradient(135deg, rgba(0, 40, 80, 0.9), rgba(0, 20, 40, 0.95));
                    padding: 40px 60px;
                    border-radius: 20px;
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
                    transform: scale(0.9);
                    transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
                }

                #game-over-screen.visible .game-over-content {
                    transform: scale(1);
                }

                .game-over-content h2 {
                    font-family: 'Segoe UI', sans-serif;
                    font-size: 24px;
                    letter-spacing: 3px;
                    color: #aaa;
                    margin-bottom: 10px;
                }

                .final-score {
                    font-size: 80px;
                    font-weight: 800;
                    color: #fff;
                    text-shadow: 0 0 30px rgba(0, 200, 255, 0.5);
                    margin: 10px 0;
                }

                #play-again-btn {
                    background: linear-gradient(90deg, #00c8ff, #0080ff);
                    border: none;
                    padding: 15px 40px;
                    color: white;
                    font-size: 20px;
                    font-weight: bold;
                    border-radius: 30px;
                    cursor: pointer;
                    margin-top: 20px;
                    transition: transform 0.2s, box-shadow 0.2s;
                    box-shadow: 0 10px 20px rgba(0, 128, 255, 0.3);
                }

                #play-again-btn:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 15px 30px rgba(0, 128, 255, 0.5);
                }
            </style>
        </div>

        <!-- Bowling Controls -->
        <div id="controls-panel">
            <div class="control-group">
                <label>Speed</label>
                <select id="speed-control">
                    <option value="slow">Slow (80 km/h)</option>
                    <option value="medium" selected>Medium (110 km/h)</option>
                    <option value="fast">Fast (140 km/h)</option>
                    <option value="express">Express (150+ km/h)</option>
                </select>
            </div>

            <div class="control-group">
                <label>Line</label>
                <select id="line-control">
                    <option value="outside-off">Outside Off</option>
                    <option value="off">Off Stump</option>
                    <option value="middle" selected>Middle</option>
                    <option value="leg">Leg Stump</option>
                    <option value="outside-leg">Outside Leg</option>
                </select>
            </div>

            <div class="control-group">
                <label>Length</label>
                <select id="length-control">
                    <option value="short">Short</option>
                    <option value="short-of-good">Short of Good</option>
                    <option value="good" selected>Good Length</option>
                    <option value="full">Full</option>
                    <option value="yorker">Yorker</option>
                </select>
            </div>

            <div class="control-group">
                <label>
                    <input type="checkbox" id="auto-bowl" />
                    Auto Bowl
                </label>
            </div>

            <!-- NEW: Swing Controls -->
            <div class="control-group">
                <label>
                    <input type="checkbox" id="swing-enabled" checked />
                    Enable Swing
                </label>
            </div>

            <div class="control-group" id="swing-controls">
                <label>Swing Type</label>
                <select id="swing-type">
                    <option value="none">No Swing</option>
                    <option value="inswing">Inswing ‚ÜôÔ∏è</option>
                    <option value="outswing" selected>Outswing ‚ÜóÔ∏è</option>
                    <option value="random">Random üé≤</option>
                </select>
            </div>

            <button id="random-btn" class="control-btn" title="Random delivery">
                üé≤
            </button>

            <button id="bowl-btn" class="control-btn primary">
                üèè Bowl
            </button>
        </div>

        <!-- Visual Guides Panel -->
        <div id="visual-guides-panel">
            <div class="guide-title">Visual Guides</div>
            <label class="guide-checkbox">
                <input type="checkbox" id="show-shadow" checked>
                <span>Ground Shadow</span>
            </label>
            <label class="guide-checkbox">
                <input type="checkbox" id="show-zone" checked>
                <span>Collision Zone</span>
            </label>
            <label class="guide-checkbox">
                <input type="checkbox" id="show-grip" checked>
                <span>Grip Indicator</span>
            </label>
            <label class="guide-checkbox">
                <input type="checkbox" id="show-trail" checked>
                <span>Swing Trail</span>
            </label>

            <!-- Stadium Lights Toggle -->
            <button id="toggle-lights" class="control-btn" style="margin-top: 10px; width: 100%;">
                üí° Lights: OFF
            </button>
        </div>

        <!-- Score Display -->
        <div id="score-display">
            <div class="score-item">
                <span class="label">Runs</span>
                <span id="runs" class="value">0</span>
            </div>
            <div class="score-item">
                <span class="label">Balls</span>
                <span id="balls" class="value">0</span>
            </div>
            <div class="score-item">
                <span class="label">Wickets</span>
                <span id="wickets" class="value">0</span>
            </div>
            <div class="score-item">
                <span class="label">Last Shot</span>
                <span id="last-shot" class="value">-</span>
            </div>
            <div class="score-item">
                <span class="label">Speed</span>
                <span id="swing-speed" class="value">0</span>
            </div>
        </div>
    </div>

    <!-- Game Scripts -->
    <script type="module" src="js/main.js?v=105"></script>
</body>

</html>