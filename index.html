<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Cricket AR - Virtual Batting</title>
    <meta name="description" content="Browser-based AR cricket game using hand gestures to bat">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">

    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/scoreboard.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/menu.css">
    <link rel="stylesheet" href="css/hud.css">

    <!-- Import Map for ES Modules -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "cannon-es": "https://cdn.jsdelivr.net/npm/cannon-es@0.20.0/dist/cannon-es.js"
        }
    }
    </script>

    <!-- MediaPipe for hand tracking (these are not ES modules) -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1675469240/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3.1675466862/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.3.1675466124/drawing_utils.js"></script>
</head>

<body>
    <div id="app">
        <!-- Splash Screen -->
        <div id="splash-screen">
            <div class="splash-content">
                <div class="splash-logo">üèè</div>
                <h1>CRICKET <span class="highlight">AR</span></h1>
                <p>IMMERSIVE BATTING EXPERIENCE</p>
            </div>
        </div>

        <!-- Loading Screen -->
        <div id="loading-screen">
            <div class="loader">
                <div class="cricket-ball"></div>
                <p>Loading Cricket AR...</p>
                <p class="loading-status">Initializing camera...</p>
            </div>
        </div>

        <!-- Lucide Icons -->
        <script src="https://unpkg.com/lucide@latest"></script>

        <!-- Mature Main Menu  -->
        <div id="main-menu">
            <div class="menu-container">
                <!-- Left: Branding & Action -->
                <div class="menu-sidebar">
                    <div class="brand">
                        <h1>CRICKET <span class="highlight">AR</span></h1>
                        <p>IMMERSIVE BATTING SIMULATOR</p>
                    </div>

                    <div class="menu-profile">
                        <!-- Resume Button (Hidden by default, shown if game active) -->
                        <button id="resume-match-btn" class="resume-btn hidden" title="Resume Match">
                            <i data-lucide="x"></i>
                        </button>

                        <div class="profile-input-group">
                            <label>Player Name</label>
                            <input type="text" id="player-name-input" value="Mr. Sano" maxlength="15"
                                placeholder="Name">
                        </div>
                        <div class="profile-input-group">
                            <label>Team (4 Char)</label>
                            <input type="text" id="team-abbr-input" value="PLR" maxlength="4" placeholder="PLR">
                        </div>
                    </div>

                    <button id="start-match-btn" class="play-btn">
                        <i data-lucide="play-circle"></i>
                        <span>PLAY MATCH</span>
                    </button>

                    <div class="menu-footer">
                        <p>Powered by <span class="tech">MediaPipe</span></p>
                    </div>
                </div>

                <!-- Right: Configuration Dashboard -->
                <div class="menu-dashboard">
                    <!-- Bowling Config Card -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <i data-lucide="settings-2"></i> Bowling Config
                        </div>
                        <div id="controls-panel-menu" class="card-content">
                            <!-- Injected Controls (Same IDs for compatibility) -->
                            <div class="control-row">
                                <label>Speed</label>
                                <select id="speed-control-menu">
                                    <option value="slow">Slow (80k)</option>
                                    <option value="medium" selected>Medium (110k)</option>
                                    <option value="fast">Fast (140k)</option>
                                    <option value="express">Express (150k+)</option>
                                </select>
                            </div>
                            <div class="control-row">
                                <label>Line</label>
                                <select id="line-control-menu">
                                    <option value="outside-off">Outside Off</option>
                                    <option value="off">Off Stump</option>
                                    <option value="middle" selected>Middle</option>
                                    <option value="leg">Leg Stump</option>
                                </select>
                            </div>
                            <div class="control-row">
                                <label>Length</label>
                                <select id="length-control-menu">
                                    <option value="short">Short</option>
                                    <option value="good" selected>Good</option>
                                    <option value="full">Full</option>
                                    <option value="yorker">Yorker</option>
                                </select>
                            </div>
                            <!-- Swing -->
                            <div class="control-row split-toggle">
                                <div class="toggle-group">
                                    <label class="toggle-text">Enable Swing</label>
                                    <label class="switch small">
                                        <input type="checkbox" id="swing-enabled-menu" checked />
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <select id="swing-type-menu" class="menu-select">
                                    <option value="outswing" selected>Outswing</option>
                                    <option value="inswing">Inswing</option>
                                    <option value="random">Random</option>
                                </select>
                            </div>
                            <div class="control-row">
                                <div class="toggle-group">
                                    <label class="toggle-text">Auto Bowl</label>
                                    <label class="switch small">
                                        <input type="checkbox" id="auto-bowl-menu" />
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Visual Guides Card -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <i data-lucide="eye"></i> Visual Guides
                        </div>
                        <div id="visual-guides-panel-menu" class="card-content grid-2">
                            <label class="guide-checkbox">
                                <input type="checkbox" id="show-shadow-menu" checked> <span>Shadows</span>
                            </label>
                            <label class="guide-checkbox">
                                <input type="checkbox" id="show-zone-menu" checked> <span>Zones</span>
                            </label>
                            <label class="guide-checkbox">
                                <input type="checkbox" id="show-grip-menu" checked> <span>Grip</span>
                            </label>
                            <label class="guide-checkbox">
                                <input type="checkbox" id="show-trail-menu" checked> <span>Trails</span>
                            </label>
                            <button id="toggle-lights-menu" class="light-btn">
                                <i data-lucide="lightbulb"></i> Lights: OFF
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Game Container -->
        <div id="game-container">
            <!-- Camera View (Left Panel) -->
            <div id="camera-panel">
                <video id="camera-feed" autoplay playsinline></video>
                <canvas id="camera-overlay"></canvas>
                <div id="ball-trajectory-overlay"></div>
                <div id="hand-status">
                    <span class="status-dot"></span>
                    <span class="status-text">Detecting hands...</span>
                </div>
            </div>

            <!-- 3D Field View (Right Panel) -->
            <div id="field-panel">
                <canvas id="field-canvas"></canvas>
                <div id="shot-result"></div>
                <div id="next-ball-warning"></div>

                <!-- Game Over Screen -->
                <div id="game-over-screen">
                    <div class="game-over-content">
                        <h2>INNINGS COMPLETE</h2>
                        <div class="final-score">
                            <span id="final-runs">0</span>/<span id="final-wickets">0</span>
                        </div>
                        <div class="match-stats">
                            <p>Overs: <span id="final-overs">0.0</span></p>
                        </div>
                        <button id="play-again-btn">
                            PLAY AGAIN ‚Üª
                        </button>
                    </div>
                </div>
            </div>

            <!-- TV Broadcast Scoreboard Overlay (Integrated into HUD) -->


            <!-- Layout Control (Top Center) -->
            <div id="layout-control">
                <button class="layout-btn" data-mode="cam" title="Larger Camera">
                    <i data-lucide="camera"></i> 3:2
                </button>
                <button class="layout-btn active" data-mode="equal" title="Equal Split">
                    <i data-lucide="columns"></i> 1:1
                </button>
                <button class="layout-btn" data-mode="game" title="Larger Game">
                    <i data-lucide="gamepad-2"></i> 2:3
                </button>
            </div>

            <style>
                #next-ball-warning {
                    position: absolute;
                    bottom: 15%;
                    /* Lower position like TV ticker */
                    left: 0;
                    right: 0;
                    width: 100%;
                    height: 60px;
                    background: linear-gradient(90deg, rgba(0, 30, 60, 0) 0%, rgba(0, 30, 60, 0.9) 20%, rgba(0, 30, 60, 0.9) 80%, rgba(0, 30, 60, 0) 100%);
                    display: flex;
                    align-items: center;
                    justify-content: center;

                    font-family: 'Segoe UI', Arial, sans-serif;
                    font-size: 24px;
                    font-weight: 700;
                    font-style: italic;
                    color: #fff;
                    letter-spacing: 2px;
                    text-transform: uppercase;

                    opacity: 0;
                    transform: translateY(20px);
                    transition: all 0.5s cubic-bezier(0.2, 1, 0.3, 1);
                    z-index: 100;
                    pointer-events: none;
                }

                #next-ball-warning.visible {
                    opacity: 1;
                    transform: translateY(0);
                }

                /* Icon/Text container inside */
                #next-ball-warning::before {
                    content: 'üèè';
                    margin-right: 15px;
                    font-style: normal;
                    animation: spin 2s infinite linear;
                }

                @keyframes spin {
                    0% {
                        transform: rotate(0deg);
                    }

                    100% {
                        transform: rotate(360deg);
                    }
                }

                /* Game Over Screen */
                #game-over-screen {
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 20, 40, 0.85);
                    backdrop-filter: blur(8px);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    opacity: 0;
                    pointer-events: none;
                    transition: opacity 0.5s ease;
                    z-index: 200;
                }

                #game-over-screen.visible {
                    opacity: 1;
                    pointer-events: auto;
                }

                .game-over-content {
                    text-align: center;
                    color: white;
                    background: linear-gradient(135deg, rgba(0, 40, 80, 0.9), rgba(0, 20, 40, 0.95));
                    padding: 40px 60px;
                    border-radius: 20px;
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
                    transform: scale(0.9);
                    transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
                }

                #game-over-screen.visible .game-over-content {
                    transform: scale(1);
                }

                .game-over-content h2 {
                    font-family: 'Segoe UI', sans-serif;
                    font-size: 24px;
                    letter-spacing: 3px;
                    color: #aaa;
                    margin-bottom: 10px;
                }

                .final-score {
                    font-size: 80px;
                    font-weight: 800;
                    color: #fff;
                    text-shadow: 0 0 30px rgba(0, 200, 255, 0.5);
                    margin: 10px 0;
                }

                #play-again-btn {
                    background: linear-gradient(90deg, #00c8ff, #0080ff);
                    border: none;
                    padding: 15px 40px;
                    color: white;
                    font-size: 20px;
                    font-weight: bold;
                    border-radius: 30px;
                    cursor: pointer;
                    margin-top: 20px;
                    transition: transform 0.2s, box-shadow 0.2s;
                    box-shadow: 0 10px 20px rgba(0, 128, 255, 0.3);
                }

                #play-again-btn:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 15px 30px rgba(0, 128, 255, 0.5);
                }
            </style>
        </div>

        <!-- Controls Moved to Main Menu -->

        <!-- === NEW HUD DASHBOARD === -->
        <div id="game-hud">
            <!-- Minimizer Handle -->
            <div id="hud-toggle-btn">
                <i data-lucide="chevron-down"></i>
            </div>

            <!-- Left Zone: Settings & Auto -->
            <div class="hud-left">
                <button id="hud-home-btn" class="hud-btn danger" title="Exit to Menu">
                    <i data-lucide="home"></i>
                </button>

                <div class="hud-toggle-container">
                    <label class="switch">
                        <input type="checkbox" id="auto-bowl">
                        <span class="slider"></span>
                    </label>
                    <span class="toggle-label">Auto Bowl</span>
                </div>

                <button id="hud-random-btn" class="hud-btn" title="Random Ball">
                    <i data-lucide="shuffle"></i>
                </button>

                <!-- Visual Settings Trigger -->
                <button id="hud-visual-btn" class="hud-btn" title="Visual Guides">
                    <i data-lucide="eye"></i>
                </button>

                <!-- Popover Menu -->
                <div id="visual-settings-popover">
                    <div class="settings-row">
                        <span>Shadows</span>
                        <label class="switch"><input type="checkbox" id="show-shadow" checked><span
                                class="slider"></span></label>
                    </div>
                    <div class="settings-row">
                        <span>Zones</span>
                        <label class="switch"><input type="checkbox" id="show-zone" checked><span
                                class="slider"></span></label>
                    </div>
                    <div class="settings-row">
                        <span>Grip</span>
                        <label class="switch"><input type="checkbox" id="show-grip" checked><span
                                class="slider"></span></label>
                    </div>
                    <div class="settings-row">
                        <span>Trails</span>
                        <label class="switch"><input type="checkbox" id="show-trail" checked><span
                                class="slider"></span></label>
                    </div>
                    <div class="settings-row">
                        <span>Lights</span>
                        <button id="toggle-lights" class="bowling-select"
                            style="width: auto; padding: 2px 8px;">OFF</button>
                    </div>
                </div>
            </div>

            <!-- Center Zone: Scoreboard (Moved to Top) -->
            <div class="hud-center">
                <div class="score-card-glass">
                    <div class="score-main-row">
                        <div class="team-badge">
                            <span id="tv-team-name" class="team-name">PLR</span>
                        </div>

                        <div class="main-stats">
                            <div class="runs-wickets-container">
                                <span id="tv-runs" class="tv-runs">0</span><span class="divider">/</span><span
                                    id="tv-wickets" class="tv-wickets">0</span>
                            </div>
                        </div>

                        <div class="secondary-stats">
                            <div class="stat-box">
                                <span class="label">OVERS</span>
                                <span id="tv-overs" class="value">0.0</span>
                            </div>
                            <div class="stat-box">
                                <span class="label">CRR</span>
                                <span id="tv-crr" class="value">0.0</span>
                            </div>
                        </div>
                    </div>

                    <div class="score-timeline-row">
                        <div class="timeline-label">THIS OVER</div>
                        <div id="tv-timeline" class="timeline-balls">
                            <!-- Balls injected via JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Zone: Manual Bowling -->
            <div class="hud-right">
                <select id="speed-control" class="bowling-select">
                    <option value="slow">Slow</option>
                    <option value="medium" selected>Medium</option>
                    <option value="fast">Fast</option>
                    <option value="express">Express</option>
                </select>

                <select id="line-control" class="bowling-select">
                    <option value="outside-off">Out Off</option>
                    <option value="off">Off</option>
                    <option value="middle" selected>Middle</option>
                    <option value="leg">Leg</option>
                </select>

                <select id="length-control" class="bowling-select">
                    <option value="short">Short</option>
                    <option value="good" selected>Good</option>
                    <option value="full">Full</option>
                    <option value="yorker">Yorker</option>
                </select>

                <button id="bowl-btn" class="bowl-action-btn">
                    BOWL
                </button>
            </div>
        </div>

        <!-- Hidden inputs for swing (preserved logic but hidden from UI for simplicity, or add to popover if needed) -->
        <div style="display:none;">
            <input type="checkbox" id="swing-enabled" checked />
            <select id="swing-type">
                <option value="outswing">Out</option>
                <option value="inswing">In</option>
                <option value="random">Rand</option>
                <option value="none">None</option>
            </select>
        </div>
    </div>

    <!-- Game Scripts -->
    <script type="module" src="js/main.js?v=105"></script>
</body>

</html>